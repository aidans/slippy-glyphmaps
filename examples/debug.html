<!DOCTYPE html>
<html>
<head>
    <title>Debug Coordinate Transformation</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 400px; }
        #debug { margin: 10px; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Debug Coordinate Transformation</h1>
    <div id="debug"></div>
    <div id="map"></div>
    
    <script type="importmap">
    {
        "imports": {
            "leaflet": "https://unpkg.com/leaflet@1.9.4/dist/leaflet-src.esm.js"
        }
    }
    </script>
    
    <script type="module">
        import * as L from "leaflet";
        
        const debugDiv = document.getElementById('debug');
        const map = L.map('map').setView([51.505, -0.09], 13);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);
        
        // Test coordinate transformation
        const testCoord = [-0.10997, 51.529163]; // [lon, lat]
        const latLng = L.latLng(testCoord[1], testCoord[0]); // Leaflet expects [lat, lng]
        const containerPoint = map.latLngToContainerPoint(latLng);
        
        debugDiv.innerHTML = `
            <h3>Coordinate Transformation Test</h3>
            <p>Original coord [lon, lat]: [${testCoord[0]}, ${testCoord[1]}]</p>
            <p>Leaflet latLng [lat, lng]: [${latLng.lat}, ${latLng.lng}]</p>
            <p>Container point: [${containerPoint.x}, ${containerPoint.y}]</p>
            <p>Map bounds: ${map.getBounds()}</p>
            <p>Map size: ${map.getSize()}</p>
            <p>Map zoom: ${map.getZoom()}</p>
            <p>Within bounds: ${map.getBounds().contains(latLng)}</p>
        `;
        
        // Add a marker to see if the point is visible
        L.marker(latLng).addTo(map).bindPopup('Test point');
        
        // Test the coordToScreenFn
        const coordToScreenFn = (coord) => {
            const point = map.latLngToContainerPoint(L.latLng(coord[1], coord[0]));
            return [point.x, point.y];
        };
        
        const screenCoord = coordToScreenFn(testCoord);
        debugDiv.innerHTML += `
            <h3>Function Test</h3>
            <p>coordToScreenFn result: [${screenCoord[0]}, ${screenCoord[1]}]</p>
        `;
    </script>
</body>
</html>
